{% extends "base.html" %}
{% block title %}Journal Trading - Kengni Finance{% endblock %}
{% block page_title %}Journal de Trading{% endblock %}
{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#journalModal">
                <i class="fas fa-plus"></i> Nouvelle Entrée
            </button>
        </div>
    </div>
    
    <div class="row g-4">
        {% for entry in entries %}
        <div class="col-md-6">
            <div class="custom-table p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <h5>{{ entry.symbol }} - {{ entry.date }}</h5>
                    <span class="status-badge {% if entry.type == 'buy' %}success{% else %}danger{% endif %}">
                        {{ entry.type }}
                    </span>
                </div>
                
                {% if entry.image_path %}
                <img src="{{ url_for('static', filename=entry.image_path.replace('static/', '')) }}" 
                     class="img-fluid rounded mb-3" alt="Trade Chart">
                {% endif %}
                
                <div class="mb-2"><strong>Stratégie:</strong> {{ entry.strategy or 'N/A' }}</div>
                <div class="mb-2"><strong>Setup:</strong> {{ entry.setup_description or 'N/A' }}</div>
                <div class="mb-2"><strong>Émotions:</strong> {{ entry.emotions or 'N/A' }}</div>
                <div class="mb-2"><strong>Leçons:</strong> {{ entry.lessons_learned or 'N/A' }}</div>
                
                {% if entry.profit_loss %}
                <div class="mt-3 p-3 rounded" style="background: rgba(0, 212, 170, 0.1);">
                    <strong>P&L:</strong> 
                    <span class="{% if entry.profit_loss > 0 %}text-success{% else %}text-danger{% endif %}">
                        {{ "%.2f"|format(entry.profit_loss) }}€
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Journal Entry Modal -->
<div class="modal fade" id="journalModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background: var(--secondary-color); color: var(--text-primary);">
            <div class="modal-header">
                <h5 class="modal-title">Nouvelle Entrée Journal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="journalForm" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Symbole</label>
                            <input type="text" class="form-control" name="symbol" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Type</label>
                            <select class="form-control" name="type" required>
                                <option value="buy">Achat</option>
                                <option value="sell">Vente</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" name="date" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Heure</label>
                            <input type="time" class="form-control" name="time" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Quantité</label>
                            <input type="number" step="0.001" class="form-control" name="quantity" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Prix d'Entrée</label>
                            <input type="number" step="0.01" class="form-control" name="entry_price" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Prix de Sortie</label>
                            <input type="number" step="0.01" class="form-control" name="exit_price">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Stratégie</label>
                        <input type="text" class="form-control" name="strategy">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Description du Setup</label>
                        <textarea class="form-control" name="setup_description" rows="2"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Émotions Ressenties</label>
                        <textarea class="form-control" name="emotions" rows="2"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Erreurs Commises</label>
                        <textarea class="form-control" name="mistakes" rows="2"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Leçons Apprises</label>
                        <textarea class="form-control" name="lessons_learned" rows="2"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Image/Chart (Optionnel)</label>
                        <input type="file" class="form-control" name="image" accept="image/*">
                        <small class="form-text text-muted">PNG, JPG, JPEG, GIF (Max 16MB)</small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary-custom w-100">Enregistrer</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('journalForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    
    const response = await fetch('/api/journal-entry', {
        method: 'POST',
        body: formData
    });
    
    if (response.ok) {
        location.reload();
    }
});
</script>
{% endblock %}